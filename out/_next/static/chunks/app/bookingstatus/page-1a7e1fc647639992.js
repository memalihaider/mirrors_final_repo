(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1376],{19946:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var s=a(12115);let l=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},r=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,s.forwardRef)((e,t)=>{let{color:a="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:d="",children:o,iconNode:m,...u}=e;return(0,s.createElement)("svg",{ref:t,...n,width:l,height:l,stroke:a,strokeWidth:c?24*Number(i)/Number(l):i,className:r("lucide",d),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...m.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(o)?o:[o]])}),c=(e,t)=>{let a=(0,s.forwardRef)((a,n)=>{let{className:c,...d}=a;return(0,s.createElement)(i,{ref:n,iconNode:t,className:r("lucide-".concat(l(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...d})});return a.displayName=l(e),a}},27334:(e,t,a)=>{Promise.resolve().then(a.bind(a,28479))},28479:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>M});var s=a(95155),l=a(12115),r=a(26597),n=a(76118),i=a(35317),c=a(56104),d=a(47924),o=a(71007),m=a(44940),u=a(40646),x=a(54861);let h=(0,a(19946).A)("circle-arrow-out-down-right",[["path",{d:"M12 22a10 10 0 1 1 10-10",key:"130bv5"}],["path",{d:"M22 22 12 12",key:"131aw7"}],["path",{d:"M22 16v6h-6",key:"1gvm70"}]]);var p=a(59836),y=a(53231),b=a(32944),g=a(72132),N=a(84423),f=a(72794),j=a(931);let v=["Al Bustan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"],k=["cash","card","bank_transfer","cobone","groupon","pay_by_link","paypal","tabby","tamara","extra_pay_mode_1","extra_pay_mode_2","user_balance","redeem"],w=["Komal","Shameem","Do Thi Kim","Alishba"];function M(){let[e,t]=(0,l.useState)([]),[a,M]=(0,l.useState)(!0),[C,S]=(0,l.useState)("bookings"),[A,D]=(0,l.useState)(""),[P,E]=(0,l.useState)("all"),[_,T]=(0,l.useState)(!1),[G,L]=(0,l.useState)(!1),[B,F]=(0,l.useState)(!1),[z,H]=(0,l.useState)(null),[I,O]=(0,l.useState)(v[0]),[U,q]=(0,l.useState)(()=>(0,p.GP)(new Date,"yyyy-MM-dd")),[$,W]=(0,l.useState)("10:00"),[Z,J]=(0,l.useState)(""),[K,Q]=(0,l.useState)("cash"),[R,Y]=(0,l.useState)(!1),[V,X]=(0,l.useState)(!1),[ee,et]=(0,l.useState)(""),[ea,es]=(0,l.useState)("upcoming"),[el,er]=(0,l.useState)([]);el.length;let[en,ei]=(0,l.useState)("this_month"),[ec,ed]=(0,l.useState)(()=>(0,p.GP)((0,y.w)(new Date),"yyyy-MM-dd")),[eo,em]=(0,l.useState)(()=>(0,p.GP)((0,b.p)(new Date),"yyyy-MM-dd")),[eu,ex]=(0,l.useState)("all"),[eh,ep]=(0,l.useState)("this_month");(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,i.GG)((0,i.rJ)(c.db,"staff")),t=[];e.forEach(e=>{let a=e.data();(null==a?void 0:a.name)&&t.push(String(a.name))}),er(t.length?t:w)}catch(e){er(w)}})()},[]),(0,l.useEffect)(()=>{let e=(0,i.P)((0,i.rJ)(c.db,"bookings"),(0,i.My)("createdAt","desc")),a=(0,i.aQ)(e,e=>{t(e.docs.map(e=>{var t,a,s,l;let r=e.data();return{id:e.id,userId:r.userId||"",customerName:r.customerName||"",customerEmail:r.customerEmail||"",services:r.services||[],bookingDate:(null==(t=r.bookingDate)?void 0:t.toDate())||new Date,bookingTime:r.bookingTime||"",branch:r.branch||"",staff:r.staffName||r.staff||"â€”",totalPrice:Number(r.totalPrice)||0,totalDuration:Number(r.totalDuration)||0,status:r.status||"upcoming",paymentMethod:r.paymentMethod||"cash",grossSales:Number(r.grossSales)||void 0,discount:Number(r.discount)||void 0,refunds:Number(r.refunds)||void 0,adjustments:Number(r.adjustments)||void 0,tax:Number(r.tax)||void 0,tips:Number(r.tips)||void 0,excludedPayments:Number(r.excludedPayments)||void 0,inHand:Number(r.inHand)||void 0,paymentDetails:r.paymentDetails||void 0,emailConfirmation:!!r.emailConfirmation,smsConfirmation:!!r.smsConfirmation,createdAt:(null==(a=r.createdAt)?void 0:a.toDate())||new Date,updatedAt:(null==(s=r.updatedAt)?void 0:s.toDate())||new Date,remarks:null!=(l=r.remarks)?l:null}})),M(!1)});return()=>a()},[]),(0,l.useEffect)(()=>{let e=new Date;switch(en){case"today":ed((0,p.GP)(e,"yyyy-MM-dd")),em((0,p.GP)(e,"yyyy-MM-dd"));break;case"yesterday":let t=(0,g.e)(e,1);ed((0,p.GP)(t,"yyyy-MM-dd")),em((0,p.GP)(t,"yyyy-MM-dd"));break;case"this_week":ed((0,p.GP)((0,N.k)(e,{weekStartsOn:1}),"yyyy-MM-dd")),em((0,p.GP)((0,f.$)(e,{weekStartsOn:1}),"yyyy-MM-dd"));break;case"this_month":ed((0,p.GP)((0,y.w)(e),"yyyy-MM-dd")),em((0,p.GP)((0,b.p)(e),"yyyy-MM-dd"))}},[en]);let ey=(0,l.useMemo)(()=>{let t=new Date(ec+"T00:00:00"),a=new Date(eo+"T23:59:59");return e.filter(e=>{let s=e.bookingDate,l="all"===eu||e.branch===eu;return s>=t&&s<=a&&l})},[e,ec,eo,eu]);(0,l.useMemo)(()=>{let e={sales:0,grossSales:0,discount:0,refunds:0,adjustments:0,tax:0,totalSalesWithTax:0,tips:0,collection:0,excludedPayments:0,inHandCollection:0,paymentMethods:{}};return k.forEach(t=>e.paymentMethods[t]=0),ey.forEach(t=>{var a,s,l,r,n,i,c,d;let o=Number(null!=(a=t.grossSales)?a:t.totalPrice)||0,m=Number(null!=(s=t.discount)?s:0)||0,u=Number(null!=(l=t.refunds)?l:0)||0,x=Number(null!=(r=t.adjustments)?r:0)||0,h=Number(null!=(n=t.tax)?n:0)||0,p=Number(null!=(i=t.tips)?i:0)||0,y=Number(null!=(c=t.excludedPayments)?c:0)||0,b=o-m-u+x;e.grossSales+=o,e.discount+=m,e.refunds+=u,e.adjustments+=x,e.tax+=h,e.tips+=p,e.excludedPayments+=y,e.sales+=b,e.totalSalesWithTax+=b+h,e.collection+=b+p;let g=Number(null!=(d=t.inHand)?d:Math.max(0,b+p-y));e.inHandCollection+=g;let N=(t.paymentMethod||"cash").toLowerCase();e.paymentMethods[N]||(e.paymentMethods[N]=0),t.paymentDetails&&"object"==typeof t.paymentDetails?Object.entries(t.paymentDetails).forEach(t=>{let[a,s]=t,l=a.toLowerCase();e.paymentMethods[l]=(e.paymentMethods[l]||0)+Number(s||0)}):e.paymentMethods[N]=(e.paymentMethods[N]||0)+Number(b+p||0)}),e},[ey]);let eb=(0,l.useMemo)(()=>{let t=A.toLowerCase();return e.filter(e=>{let a=e.customerName.toLowerCase().includes(t)||e.branch.toLowerCase().includes(t)||e.services.some(e=>e.serviceName.toLowerCase().includes(t)),s="all"===P||e.status===P;return a&&s})},[e,A,P]),eg=()=>{O(v[0]),et(""),q((0,p.GP)(new Date,"yyyy-MM-dd")),W("10:00"),J(""),Q("cash"),Y(!1),X(!1),es("upcoming"),setStaff(""),H(null)},eN=e=>{H(e.id),O(e.branch||v[0]),q((0,p.GP)(e.bookingDate,"yyyy-MM-dd")),W(e.bookingTime||"10:00"),J(e.customerName||""),et(e.customerEmail||""),Q(e.paymentMethod||"cash"),Y(!!e.emailConfirmation),X(!!e.smsConfirmation),es(e.status||"upcoming"),setStaff(e.staff||""),T(!0)},ef=async(e,t)=>{try{let a=(0,i.H9)(c.db,"bookings",e);await (0,i.mZ)(a,{status:t,updatedAt:(0,i.O5)()})}catch(e){console.error("Error updating booking status:",e),alert("Failed to update status.")}};return a?(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600 mx-auto"}),(0,s.jsx)("p",{className:"text-center mt-2",children:"Loading..."})]}):(0,s.jsx)(j.A,{children:(0,s.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Bookings & Finance"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Merged bookings UI + Finance reports (realtime from Firestore)"})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:(0,s.jsx)("button",{onClick:()=>S("bookings"),className:"px-3 py-2 rounded ".concat("bookings"===C?"bg-pink-600 text-white":"bg-gray-100"),children:"Bookings"})})]}),"bookings"===C&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 flex gap-4 items-center",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(d.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{value:A,onChange:e=>D(e.target.value),className:"pl-10 pr-3 py-2 w-full border rounded",placeholder:"Search by customer, branch, service..."})]}),(0,s.jsxs)("select",{value:P,onChange:e=>E(e.target.value),className:"border rounded px-3 py-2",children:[(0,s.jsx)("option",{value:"all",children:"All Status"}),(0,s.jsx)("option",{value:"upcoming",children:"Upcoming"}),(0,s.jsx)("option",{value:"past",children:"Past"}),(0,s.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Customer"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Services"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Date & Time"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Staff"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Branch"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Payment"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Actions"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Invoice"})]})}),(0,s.jsx)("tbody",{children:eb.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>eN(e),children:[(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-pink-100 flex items-center justify-center",children:(0,s.jsx)(o.A,{className:"w-5 h-5 text-pink-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.customerName}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.customerEmail||"No email"})]})]})}),(0,s.jsxs)("td",{className:"px-4 py-3",children:[e.services.slice(0,2).map((e,t)=>(0,s.jsxs)("div",{children:[e.serviceName," ",e.quantity>1&&"(x".concat(e.quantity,")")]},t)),e.services.length>2&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["+",e.services.length-2," more"]})]}),(0,s.jsxs)("td",{className:"px-4 py-3",children:[(0,s.jsx)("div",{children:(0,p.GP)(e.bookingDate,"MMM dd, yyyy")}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.bookingTime})]}),(0,s.jsx)("td",{className:"px-4 py-3",children:e.staff||"â€”"}),(0,s.jsx)("td",{className:"px-4 py-3",children:e.branch}),(0,s.jsxs)("td",{className:"px-4 py-3",children:["AED",e.totalPrice.toFixed(2)," ",(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.paymentMethod})]}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full bg-gray-100 text-xs",children:e.status})}),(0,s.jsx)("td",{className:"px-4 py-3",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>eN(e),title:"Edit",className:"text-emerald-700",children:(0,s.jsx)(m.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>ef(e.id,"past"),title:"Mark as completed",className:"text-green-600",children:(0,s.jsx)(u.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>ef(e.id,"cancelled"),title:"Cancel",className:"text-red-600",children:(0,s.jsx)(x.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>ef(e.id,"upcoming"),title:"Upcoming",className:"text-blue-600",children:(0,s.jsx)(h,{className:"w-4 h-4"})})]})}),(0,s.jsx)("td",{className:"px-4 py-3",onClick:e=>e.stopPropagation(),children:(0,s.jsx)("button",{onClick:()=>(e=>{var t;let a=new r.Ay({unit:"pt",format:"a4",orientation:"portrait"});a.setFontSize(18),a.text("Invoice",40,40),a.setFontSize(12),a.text("Customer: ".concat(e.customerName),40,70),a.text("Email: ".concat(e.customerEmail||"N/A"),40,90),a.text("Booking Date: ".concat((0,p.GP)(e.bookingDate,"MMM dd, yyyy")),40,110),a.text("Time: ".concat(e.bookingTime),40,130),a.text("Branch: ".concat(e.branch),40,150),a.text("Staff: ".concat(e.staff||"â€”"),40,170);let s=e.services.map((e,t)=>[t+1,e.serviceName,e.quantity,"$".concat(Number(e.price).toFixed(2)),"$".concat((Number(e.price)*Number(e.quantity)).toFixed(2))]);(0,n.Ay)(a,{head:[["#","Service","Qty","Unit Price","Total"]],body:s,startY:200,theme:"grid",styles:{fontSize:10},margin:{left:40,right:40}});let l=(null==(t=a.lastAutoTable)?void 0:t.finalY)||200;a.setFontSize(12),a.text("Total Duration: ".concat(e.totalDuration," min"),40,l+25),a.text("Total Price: $".concat(e.totalPrice.toFixed(2)),40,l+45),a.save("Invoice_".concat(e.customerName.replace(/\s+/g,"_"),".pdf"))})(e),className:"px-2 py-1 bg-pink-600 text-white rounded",children:"Invoice"})})]},e.id))})]})}),0===eb.length&&(0,s.jsx)("div",{className:"text-center py-10 text-gray-500",children:"No bookings found."}),_&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-700 bg-opacity-50 z-50 flex items-start justify-center overflow-y-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-11/12 md:w-3/4 mt-10",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,s.jsx)("h3",{className:"font-semibold",children:z?"Edit Booking":"Add Booking"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[z&&(0,s.jsx)("button",{onClick:async()=>{if(confirm("Delete?")){F(!0);try{await (0,i.kd)((0,i.H9)(c.db,"bookings",z)),T(!1),eg()}catch(e){console.error(e),alert("Delete failed")}finally{F(!1)}}},className:"px-3 py-1 bg-red-600 text-white rounded",children:"Delete"}),(0,s.jsx)("button",{onClick:()=>{T(!1),eg()},className:"px-3 py-1",children:"Close"})]})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Branch"}),(0,s.jsx)("select",{value:I,onChange:e=>O(e.target.value),className:"w-full border rounded p-2",children:v.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Staff"}),(0,s.jsx)("select",{value:"",onChange:()=>{},className:"w-full border rounded p-2",children:(0,s.jsx)("option",{children:"â€”"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Payment"}),(0,s.jsx)("select",{value:K,onChange:e=>Q(e.target.value),className:"w-full border rounded p-2",children:["cash","card"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Service Date"}),(0,s.jsx)("input",{type:"date",value:U,onChange:e=>q(e.target.value),className:"w-full border rounded p-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Time"}),(0,s.jsx)("input",{type:"time",value:$,onChange:e=>W(e.target.value),className:"w-full border rounded p-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Customer Name"}),(0,s.jsx)("input",{value:Z,onChange:e=>J(e.target.value),className:"w-full border rounded p-2"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>{T(!1),eg()},children:"Close"}),(0,s.jsx)("button",{className:"px-3 py-2 bg-emerald-600 text-white rounded",onClick:async()=>{alert("Use back-end saving as needed")},children:"Save"})]})]})]})})]})]})})}},40646:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},44940:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},47924:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},54861:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},71007:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])}},e=>{e.O(0,[9135,7210,3930,5033,1748,9836,6373,6895,9323,931,8441,5964,7358],()=>e(e.s=27334)),_N_E=e.O()}]);