(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5022],{79680:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(95155),l=s(12115),d=s(26597),n=s(76118),i=s(35317),r=s(56104),c=s(59836),o=s(53231),x=s(32944),m=s(72132),h=s(84423),u=s(72794),p=s(931);let y=["Al Bustan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"],N=["cash","card","bank_transfer","cobone","groupon","pay_by_link","paypal","tabby","tamara","extra_pay_mode_1","extra_pay_mode_2","user_balance","redeem"],j=["Komal","Shameem","Do Thi Kim","Alishba"];function b(){var e,t,s,b,g,v,f,M,D,S,w,F,A,E,k;let[C,P]=(0,l.useState)([]),[T,_]=(0,l.useState)(!0),[G,B]=(0,l.useState)("bookings"),[H,$]=(0,l.useState)(""),[L,O]=(0,l.useState)("all"),[I,R]=(0,l.useState)(!1),[z,W]=(0,l.useState)(!1),[J,K]=(0,l.useState)(!1),[Y,q]=(0,l.useState)(null),[Q,U]=(0,l.useState)(y[0]),[V,X]=(0,l.useState)(()=>(0,c.GP)(new Date,"yyyy-MM-dd")),[Z,ee]=(0,l.useState)("10:00"),[et,es]=(0,l.useState)(""),[ea,el]=(0,l.useState)("cash"),[ed,en]=(0,l.useState)(!1),[ei,er]=(0,l.useState)(!1),[ec,eo]=(0,l.useState)(""),[ex,em]=(0,l.useState)("upcoming"),[eh,eu]=(0,l.useState)([]);eh.length;let[ep,ey]=(0,l.useState)("this_month"),[eN,ej]=(0,l.useState)(()=>(0,c.GP)((0,o.w)(new Date),"yyyy-MM-dd")),[eb,eg]=(0,l.useState)(()=>(0,c.GP)((0,x.p)(new Date),"yyyy-MM-dd")),[ev,ef]=(0,l.useState)("all"),[eM,eD]=(0,l.useState)("this_month");(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,i.GG)((0,i.rJ)(r.db,"staff")),t=[];e.forEach(e=>{let s=e.data();(null==s?void 0:s.name)&&t.push(String(s.name))}),eu(t.length?t:j)}catch(e){eu(j)}})()},[]),(0,l.useEffect)(()=>{let e=(0,i.P)((0,i.rJ)(r.db,"bookings"),(0,i.My)("createdAt","desc")),t=(0,i.aQ)(e,e=>{P(e.docs.map(e=>{var t,s,a,l;let d=e.data();return{id:e.id,userId:d.userId||"",customerName:d.customerName||"",customerEmail:d.customerEmail||"",services:d.services||[],bookingDate:(null==(t=d.bookingDate)?void 0:t.toDate())||new Date,bookingTime:d.bookingTime||"",branch:d.branch||"",staff:d.staffName||d.staff||"—",totalPrice:Number(d.totalPrice)||0,totalDuration:Number(d.totalDuration)||0,status:d.status||"upcoming",paymentMethod:d.paymentMethod||"cash",grossSales:Number(d.grossSales)||void 0,discount:Number(d.discount)||void 0,refunds:Number(d.refunds)||void 0,adjustments:Number(d.adjustments)||void 0,tax:Number(d.tax)||void 0,tips:Number(d.tips)||void 0,excludedPayments:Number(d.excludedPayments)||void 0,inHand:Number(d.inHand)||void 0,paymentDetails:d.paymentDetails||void 0,emailConfirmation:!!d.emailConfirmation,smsConfirmation:!!d.smsConfirmation,createdAt:(null==(s=d.createdAt)?void 0:s.toDate())||new Date,updatedAt:(null==(a=d.updatedAt)?void 0:a.toDate())||new Date,remarks:null!=(l=d.remarks)?l:null}})),_(!1)});return()=>t()},[]),(0,l.useEffect)(()=>{let e=new Date;switch(ep){case"today":ej((0,c.GP)(e,"yyyy-MM-dd")),eg((0,c.GP)(e,"yyyy-MM-dd"));break;case"yesterday":let t=(0,m.e)(e,1);ej((0,c.GP)(t,"yyyy-MM-dd")),eg((0,c.GP)(t,"yyyy-MM-dd"));break;case"this_week":ej((0,c.GP)((0,h.k)(e,{weekStartsOn:1}),"yyyy-MM-dd")),eg((0,c.GP)((0,u.$)(e,{weekStartsOn:1}),"yyyy-MM-dd"));break;case"this_month":ej((0,c.GP)((0,o.w)(e),"yyyy-MM-dd")),eg((0,c.GP)((0,x.p)(e),"yyyy-MM-dd"))}},[ep]);let eS=(0,l.useMemo)(()=>{let e=new Date(eN+"T00:00:00"),t=new Date(eb+"T23:59:59");return C.filter(s=>{let a=s.bookingDate,l="all"===ev||s.branch===ev;return a>=e&&a<=t&&l})},[C,eN,eb,ev]),ew=(0,l.useMemo)(()=>{let e={sales:0,grossSales:0,discount:0,refunds:0,adjustments:0,tax:0,totalSalesWithTax:0,tips:0,collection:0,excludedPayments:0,inHandCollection:0,paymentMethods:{}};return N.forEach(t=>e.paymentMethods[t]=0),eS.forEach(t=>{var s,a,l,d,n,i,r,c;let o=Number(null!=(s=t.grossSales)?s:t.totalPrice)||0,x=Number(null!=(a=t.discount)?a:0)||0,m=Number(null!=(l=t.refunds)?l:0)||0,h=Number(null!=(d=t.adjustments)?d:0)||0,u=Number(null!=(n=t.tax)?n:0)||0,p=Number(null!=(i=t.tips)?i:0)||0,y=Number(null!=(r=t.excludedPayments)?r:0)||0,N=o-x-m+h;e.grossSales+=o,e.discount+=x,e.refunds+=m,e.adjustments+=h,e.tax+=u,e.tips+=p,e.excludedPayments+=y,e.sales+=N,e.totalSalesWithTax+=N+u,e.collection+=N+p;let j=Number(null!=(c=t.inHand)?c:Math.max(0,N+p-y));e.inHandCollection+=j;let b=(t.paymentMethod||"cash").toLowerCase();e.paymentMethods[b]||(e.paymentMethods[b]=0),t.paymentDetails&&"object"==typeof t.paymentDetails?Object.entries(t.paymentDetails).forEach(t=>{let[s,a]=t,l=s.toLowerCase();e.paymentMethods[l]=(e.paymentMethods[l]||0)+Number(a||0)}):e.paymentMethods[b]=(e.paymentMethods[b]||0)+Number(N+p||0)}),e},[eS]);return((0,l.useMemo)(()=>{let e=H.toLowerCase();return C.filter(t=>{let s=t.customerName.toLowerCase().includes(e)||t.branch.toLowerCase().includes(e)||t.services.some(t=>t.serviceName.toLowerCase().includes(e)),a="all"===L||t.status===L;return s&&a})},[C,H,L]),T)?(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600 mx-auto"}),(0,a.jsx)("p",{className:"text-center mt-2",children:"Loading..."})]}):(0,a.jsx)(p.A,{children:(0,a.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Bookings & Finance"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Merged bookings UI + Finance reports (realtime from Firestore)"})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)("button",{onClick:()=>B("finance"),className:"px-3 py-2 rounded ".concat("finance"===G?"bg-pink-600 text-white":"bg-gray-100"),children:"Finance Reports"})})]}),"finance"===G&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Branch"}),(0,a.jsxs)("select",{value:ev,onChange:e=>ef(e.target.value),className:"w-full border rounded p-2",children:[(0,a.jsx)("option",{value:"all",children:"All Branches"}),y.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Timeline"}),(0,a.jsxs)("select",{value:ep,onChange:e=>ey(e.target.value),className:"w-full border rounded p-2",children:[(0,a.jsx)("option",{value:"today",children:"Today"}),(0,a.jsx)("option",{value:"yesterday",children:"Yesterday"}),(0,a.jsx)("option",{value:"this_week",children:"This Week"}),(0,a.jsx)("option",{value:"this_month",children:"This Month"}),(0,a.jsx)("option",{value:"custom",children:"Custom"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"From"}),(0,a.jsx)("input",{type:"date",value:eN,onChange:e=>{ej(e.target.value),ey("custom")},className:"w-full border rounded p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"To"}),(0,a.jsx)("input",{type:"date",value:eb,onChange:e=>{eg(e.target.value),ey("custom")},className:"w-full border rounded p-2"})]}),(0,a.jsx)("div",{className:"md:col-span-4 flex justify-end gap-2 mt-2",children:(0,a.jsx)("button",{onClick:()=>{let e=new d.Ay({unit:"pt",format:"a4",orientation:"landscape"});e.setFontSize(16),e.text("Finance Report",40,40);let t=["Branch: ".concat(ev),"From: ".concat(eN),"To: ".concat(eb)];e.setFontSize(10),e.text(t.join("   "),40,60);let s=eS.map(e=>{var t,s,a,l,d,n;let i=Number(null!=(t=e.grossSales)?t:e.totalPrice)||0,r=Number(null!=(s=e.discount)?s:0)||0,o=Number(null!=(a=e.refunds)?a:0)||0,x=Number(null!=(l=e.adjustments)?l:0)||0,m=Number(null!=(d=e.tax)?d:0)||0,h=Number(null!=(n=e.tips)?n:0)||0,u=i-r-o+x;return[e.customerName,(0,c.GP)(e.bookingDate,"yyyy-MM-dd"),e.bookingTime,e.branch,e.staff||"—","$".concat(i.toFixed(2)),"$".concat(r.toFixed(2)),"$".concat(o.toFixed(2)),"$".concat(x.toFixed(2)),"$".concat(u.toFixed(2)),"$".concat(m.toFixed(2)),"$".concat((u+m).toFixed(2)),"$".concat(h.toFixed(2)),e.paymentMethod]});(0,n.Ay)(e,{head:[["Customer","Date","Time","Branch","Staff","Gross","Discount","Refunds","Adjustments","Net Sales","Tax","Total Sales","Tips","Payment Method"]],body:s,startY:80,styles:{fontSize:9},margin:{left:20,right:20}}),e.save("Finance_Report_".concat(eN,"_to_").concat(eb,".pdf"))},className:"px-3 py-2 bg-pink-600 text-white rounded",children:"Export PDF"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Gross Sales"}),(0,a.jsxs)("div",{className:"text-xl font-semibold",children:["AED",(null==(e=ew.grossSales)?void 0:e.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Net Sales"}),(0,a.jsxs)("div",{className:"text-xl font-semibold",children:["AED",(null==(t=ew.sales)?void 0:t.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Tax"}),(0,a.jsxs)("div",{className:"text-xl font-semibold",children:["AED",(null==(s=ew.tax)?void 0:s.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"In-Hand Collection"}),(0,a.jsxs)("div",{className:"text-xl font-semibold",children:["AED",(null==(b=ew.inHandCollection)?void 0:b.toFixed(2))||"0.00"]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded shadow overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Metric / Payment Method"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Amount"})]})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Sales (Net)"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(g=ew.sales)?void 0:g.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Gross Sales"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(v=ew.grossSales)?void 0:v.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Discount"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(f=ew.discount)?void 0:f.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Refunds"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(M=ew.refunds)?void 0:M.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Adjustments"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(D=ew.adjustments)?void 0:D.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Tax"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(S=ew.tax)?void 0:S.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Total Sales (Tax + Net)"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(w=ew.totalSalesWithTax)?void 0:w.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Tips"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(F=ew.tips)?void 0:F.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Collection (Sales + Tips)"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(A=ew.collection)?void 0:A.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"Excluded Payments"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(E=ew.excludedPayments)?void 0:E.toFixed(2))||"0.00"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:"In-Hand Collection"}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(null==(k=ew.inHandCollection)?void 0:k.toFixed(2))||"0.00"]})]}),Object.entries(ew.paymentMethods||{}).map(e=>{let[t,s]=e;return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-4 py-2 capitalize",children:t.replace(/_/g," ")}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(Number(s)||0).toFixed(2)]})]},t)})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded shadow mt-6 overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Customer"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Date"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Branch"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Gross"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Discount"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Refunds"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Adjust"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Net"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Tax"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Total"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Tips"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Payment"})]})}),(0,a.jsx)("tbody",{children:eS.map(e=>{var t,s,l,d,n,i;let r=Number(null!=(t=e.grossSales)?t:e.totalPrice)||0,o=Number(null!=(s=e.discount)?s:0)||0,x=Number(null!=(l=e.refunds)?l:0)||0,m=Number(null!=(d=e.adjustments)?d:0)||0,h=Number(null!=(n=e.tax)?n:0)||0,u=Number(null!=(i=e.tips)?i:0)||0,p=r-o-x+m;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{q(e.id),U(e.branch||y[0]),X((0,c.GP)(e.bookingDate,"yyyy-MM-dd")),ee(e.bookingTime||"10:00"),es(e.customerName||""),eo(e.customerEmail||""),el(e.paymentMethod||"cash"),en(!!e.emailConfirmation),er(!!e.smsConfirmation),em(e.status||"upcoming"),setStaff(e.staff||""),R(!0)},children:[(0,a.jsx)("td",{className:"px-4 py-2",children:e.customerName}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,c.GP)(e.bookingDate,"yyyy-MM-dd")}),(0,a.jsx)("td",{className:"px-4 py-2",children:e.branch}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",r.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",o.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",x.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",m.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",p.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",h.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",(p+h).toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-right",children:["AED",u.toFixed(2)]}),(0,a.jsx)("td",{className:"px-4 py-2 text-left",children:e.paymentMethod})]},e.id)})})]})})]})]})})}},90596:(e,t,s)=>{Promise.resolve().then(s.bind(s,79680))}},e=>{e.O(0,[9135,7210,3930,5033,1748,9836,6373,6895,9323,931,8441,5964,7358],()=>e(e.s=90596)),_N_E=e.O()}]);